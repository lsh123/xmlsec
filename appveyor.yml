# Continuous Integration script for xmlsec
# Author: Peter Budai <peterbudai@hotmail.com>

# In order to enable appveyor CI in your GitHub repository, please follow the steps
# described in Appyors's Getting Started:  https://www.appveyor.com/docs/
#
# After you add your project to Appveyor, it will recognize this script, and will
# launch the first build process. Every build runs on a fresh virtual machine which is
# not shared with other builds and the state of which is not preserved between consequent
# builds. After the build is finished its virtual machine is decommissioned.
#
# You can check the whole build process in the logs, and any later commit will start
# a new build using a fresh virtual machine.

init:
  - git config --global core.autocrlf input

shallow_clone: true

environment:
  matrix:
    # enable shared linking
    - STATIC: no
      COMPILER: MinGW-w64
      PLATFORM: x64

    # enable static linking
    - STATIC: yes
      COMPILER: MinGW-w64
      PLATFORM: x64

install:
  - if [%COMPILER%]==[MinGW-w64] C:\msys64\usr\bin\pacman -S --noconfirm mingw-w64-x86_64-toolchain
  - if [%COMPILER%]==[MinGW-w64] C:\msys64\usr\bin\pacman -S --noconfirm mingw-w64-x86_64-{libtool,libxml2,libxslt,openssl,gnutls}
  - if [%COMPILER%]==[MinGW-w64] C:\msys64\usr\bin\pacman --noconfirm --sync --refresh --refresh --sysupgrade --sysupgrade

build_script:
  - mkdir build
  - cd build
  - if [%COMPILER%]==[MinGW-w64] ../autogen.sh --build="x86_64-w64-mingw32" --host="x86_64-w64-mingw32" --enable-mscrypto --enable-static-linking=$STATIC
  - make

test_script:
  - make check
